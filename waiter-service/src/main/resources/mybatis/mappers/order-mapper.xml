<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE mapper PUBLIC '-//mybatis.org//DTD Mapper 3.0//EN'
        'http://mybatis.org/dtd/mybatis-3-mapper.dtd'>
<mapper namespace="ru.kaznacheev.restaurant.waiterservice.mapper.OrderMapper">

    <resultMap id="OrderResultMap" type="Order">
        <id property="id" column="order_no"/>
        <result property="status" column="status"/>
        <result property="createdAt" column="created_dttm"/>
        <result property="waiterId" column="waiter_id"/>
        <result property="tableNumber" column="table_no"/>
    </resultMap>

    <insert id="save" useGeneratedKeys="true" keyColumn="order_no" keyProperty="id">
        INSERT INTO waiter_order
            (status, create_dttm, waiter_id, table_no)
        VALUES
            (#{order.status}, #{order.createdAt}, #{order.waiterId}, #{order.tableNumber});
    </insert>

    <select id="getOrderById" resultMap="OrderResultMap">
        SELECT order_no, status, create_dttm, waiter_id, table_no
        FROM waiter_order
        WHERE order_no = #{id};
    </select>

    <select id="getAllOrders" resultMap="OrderResultMap">
        SELECT order_no, status, create_dttm, waiter_id, table_no
        FROM waiter_order
    </select>

    <select id="getOrderStatusById" resultType="ru.kaznacheev.restaurant.waiterservice.entity.OrderStatus">
        SELECT status
        FROM waiter_order
        WHERE order_no = #{id};
    </select>

</mapper>